###### Mobile Phone Energy ######

type: vertical-stack
cards:
  - type: custom:mushroom-template-card
    primary: engineering
    secondary: stardate {{states('sensor.stardate')}}
    icon: mdi:cog
  - type: custom:mushroom-template-card
    primary: |
      Captains Log: Stardate {{states('sensor.stardate')}} 
    secondary: >
      {% set time = now().hour %} {% if (time >= 18) %} Good Evening {{ user
      }}.  {% elif (time >=12) %} Good Afternoon {{ user }}.  {% elif (time >=
      5) %} Good Morning {{ user }}.  {% else %} Hello {{ user }}.  {% endif %} 

      Energy dashboard selected.

      Terrestrial date is {{ states('sensor.day_of_week')}} {{
      as_timestamp(now()) | timestamp_custom ('%-d %B %Y' )}}. 

      Today, the warp core generated
      {{states('sensor.solar_panel_production_daily')}} kWh
    multiline_secondary: true
    fill_container: true
    icon: ""
    card_mod:
      class: middle-contained
      style: |
        ha-card {
          --card-primary-font-size: 17px !important;
          --card-secondary-line-height: 23px !important;
        }
  - type: custom:html-card
    card_mod:
      class: footer-contained
    content: |
      &nbsp;
  - type: custom:html-card
    card_mod:
      class: header-contained
    content: |
      <h1>auxilliary power</h1>
  - type: gauge
    card_mod:
      class: middle-contained
    entity: sensor.solaredge_b1_state_of_energy
    needle: true
    segments:
      - from: 0
        to: 2
        color: "#ff0f0f"
      - from: 2
        to: 4
        color: "#ff0f17"
      - from: 4
        to: 6
        color: "#ff0d10"
      - from: 6
        to: 8
        color: "#ff0b0a"
      - from: 8
        to: 10
        color: "#ff0904"
      - from: 10
        to: 12
        color: "#ff1604"
      - from: 12
        to: 14
        color: "#ff2304"
      - from: 14
        to: 16
        color: "#ff3004"
      - from: 16
        to: 18
        color: "#ff3d04"
      - from: 18
        to: 20
        color: "#ff4a05"
      - from: 20
        to: 22
        color: "#ff5705"
      - from: 22
        to: 24
        color: "#ff6405"
      - from: 24
        to: 26
        color: "#ff7106"
      - from: 26
        to: 28
        color: "#ff7e06"
      - from: 28
        to: 30
        color: "#ff8b06"
      - from: 30
        to: 32
        color: "#ff9807"
      - from: 32
        to: 34
        color: "#ffa507"
      - from: 34
        to: 36
        color: "#ffb207"
      - from: 36
        to: 38
        color: "#ffbf07"
      - from: 38
        to: 40
        color: "#ffcc07"
      - from: 40
        to: 42
        color: "#ffd024"
      - from: 42
        to: 44
        color: "#ffd441"
      - from: 44
        to: 46
        color: "#ffd85e"
      - from: 46
        to: 48
        color: "#ffdc7b"
      - from: 48
        to: 50
        color: "#ffe198"
      - from: 50
        to: 52
        color: "#ffe689"
      - from: 52
        to: 54
        color: "#ffeb7a"
      - from: 54
        to: 56
        color: "#fff06b"
      - from: 56
        to: 58
        color: "#fff55c"
      - from: 58
        to: 60
        color: "#fffa4d"
      - from: 60
        to: 62
        color: "#ffff3e"
      - from: 62
        to: 64
        color: "#fdff3c"
      - from: 64
        to: 66
        color: "#fcff39"
      - from: 66
        to: 68
        color: "#e9ff36"
      - from: 68
        to: 70
        color: "#d6ff34"
      - from: 70
        to: 72
        color: "#c3ff31"
      - from: 72
        to: 74
        color: "#aff92f"
      - from: 74
        to: 76
        color: "#9cff2c"
      - from: 76
        to: 78
        color: "#89ff2a"
      - from: 78
        to: 80
        color: "#76f927"
      - from: 80
        to: 82
        color: "#63f324"
      - from: 82
        to: 84
        color: "#50ed20"
      - from: 84
        to: 86
        color: "#3ce71d"
      - from: 86
        to: 88
        color: "#29e11b"
      - from: 88
        to: 90
        color: "#16db18"
      - from: 90
        to: 92
        color: "#04d916"
      - from: 92
        to: 94
        color: "#04d916"
      - from: 94
        to: 96
        color: "#04d916"
      - from: 96
        to: 98
        color: "#04d916"
      - from: 98
        to: 100
        color: "#04d916"
    name: Power Remaining
    min: 0
    max: 100
  - type: entities
    card_mod:
      class: middle-contained
    entities:
      - entity: sensor.solar_battery_empty_time
        name: Battery empty at
        card_mod:
          style: |
            :host {
              --card-mod-icon-color: orange;
            }
      - entity: sensor.solar_battery_daytime_topup_needed
        name: Daytime topup needed
        card_mod:
          style: |
            :host {
              {% if is_state("sensor.solar_battery_daytime_topup_needed","true") %}
              --card-mod-icon: mdi:check-circle-outline;
              --card-mod-icon-color: green;
              {% else %}
              --card-mod-icon: mdi:checkbox-blank-circle-outline;
              --card-mod-icon-color: crimson;
              {% endif %}
            }
      - entity: sensor.solar_battery_time_to_charge_solar
        name: Hours remaining to full
        icon: mdi:timelapse
        card_mod:
          style: |
            :host {
              {% if is_state("sensor.solar_battery_time_to_charge_solar","Full") %}
              --card-mod-icon: mdi:camera-timer;
              --card-mod-icon-color: green;
              {% elif is_state("sensor.solar_battery_time_to_charge_solar","Discharging")%}
              --card-mod-icon: mdi:camera-timer;
              --card-mod-icon-color: orange;
              {% else %}
              --card-mod-icon: mdi:camera-timer;
              --card-mod-icon-color: lightgreen;
              {% endif %}
            }
      - entity: sensor.solar_battery_time_to_charge_grid
        name: Length of time to grid charge
        icon: mdi:clock
        card_mod:
          style: |
            :host {
              {% if is_state("sensor.solar_battery_time_to_charge_grid","Not Needed") %}
              --card-mod-icon: mdi:clock;
              --card-mod-icon-color: green;
              {% elif is_state("sensor.solar_battery_time_to_charge_solar","Discharging")%}
              --card-mod-icon: mdi:clock;
              --card-mod-icon-color: orange;
              {% else %}
              --card-mod-icon: mdi:clock;
              --card-mod-icon-color: lightgreen;
              {% endif %}
  - type: custom:html-card
    card_mod:
      class: footer-contained
    content: |
      &nbsp;
  - type: custom:html-card
    card_mod:
      class: header-contained
    content: |
      <h1>warp core intermix</h1>
  - type: custom:power-distribution-card
    entities:
      - name: SE4000H
        preset: solar
        icon: mdi:solar-power
        entity: sensor.inverter_1_production
        unit_of_display: W
        decimals: 0
        color_threshold: "1000"
        icon_color:
          bigger: Lime
          smaller: Orangered
        arrow_color:
          bigger: Lime
          smaller: Orangered
      - name: Home
        preset: home
        icon: mdi:home
        entity: sensor.power_consumption
        unit_of_display: W
        decimals: 0
        invert_value: false
        invert_arrow: true
        color_threshold: "1500"
        icon_color:
          bigger: Orangered
          smaller: Lime
        arrow_color:
          bigger: Orangered
          smaller: Lime
      - name: SE3680H
        preset: solar
        icon: mdi:solar-power
        entity: sensor.solaredge_i2_dc_power
        unit_of_display: W
        decimals: 0
        color_threshold: "1000"
        icon_color:
          bigger: Lime
          smaller: Orangered
        arrow_color:
          bigger: Lime
          smaller: Orangered
      - display_abs: true
        name: car
        unit_of_display: W
        consumer: true
        invert_arrow: true
        icon: mdi:car-electric
        preset: car_charger
        entity: sensor.shellyem_244cab4194b1_channel_2_power
        decimals: "0"
        secondary_info_entity: input_number.car_battery_charge_level
        secondary_info_replace_name: true
        color_threshold: "500"
        icon_color:
          bigger: lime
          smaller: orangered
        arrow_color:
          bigger: lime
          smaller: orangered
      - decimals: 2
        display_abs: true
        name: placeholder
        unit_of_display: W
        preset: placeholder
      - display_abs: true
        name: Water
        unit_of_display: W
        consumer: true
        icon: mdi:water-boiler
        preset: consumer
        entity: sensor.shellyem_244cab4194b1_channel_1_power
        decimals: "0"
        invert_value: true
        color_threshold: "500"
        icon_color:
          bigger: Lime
          smaller: Orangered
        arrow_color:
          bigger: Lime
          smaller: Orangered
      - name: Grid
        preset: grid
        icon: mdi:transmission-tower
        entity: sensor.solaredge_m1_ac_power
        unit_of_display: W
        decimals: 0
        invert_value: true
        invert_arrow: false
        color_threshold: "1000"
        icon_color:
          bigger: Orangered
          smaller: Lime
        arrow_color:
          bigger: Orangered
          smaller: Lime
      - name: Battery
        preset: battery
        icon: mdi:battery-high
        entity: sensor.solaredge_b1_dc_power
        unit_of_display: W
        decimals: ""
        invert_value: false
        invert_arrow: true
        color_threshold: "3500"
        icon_color:
          bigger: Orangered
          smaller: Lime
        arrow_color:
          bigger: Orangered
          smaller: Lime
        secondary_info_entity: sensor.battery_state_of_charge
        secondary_info_replace_name: true
        display_abs: true
    center:
      type: bars
      content:
        - preset: custom
          name: INV 1
          bar_color: lime
          bar_bg_color: palegreen
          entity: sensor.inverter_1_efficiency_int
        - preset: custom
          name: INV 2
          bar_color: Lime
          bar_bg_color: pale green
          entity: sensor.inverter_2_efficiency_int
        - name: BATT
          preset: custom
          entity: sensor.solar_battery_efficiency_int
          bar_color: Orangered
          bar_bg_color: Salmon
    animation: flash
    card_mod:
      class: middle-contained
  - type: custom:html-card
    card_mod:
      class: footer-contained
    content: |
      &nbsp;
  - type: custom:html-card
    card_mod:
      class: bar-right
    content: |
      <h1>eps conduit flow</h1>
  - type: custom:tesla-style-solar-power-card
    card_mod:
      class: middle-open
      style: |
        ha-card {
          --ha-card-background: none;
          color: var(--primary-color);
            }
    threshold_in_k: 1
    show_gap: true
    hide_inactive_lines: 1
    change_house_bubble_color_with_flow: 1
    generation_icon: mdi:solar-power-variant-outline
    house_entity: sensor.power_consumption
    grid_entity: sensor.solaredge_m1_ac_power
    generation_entity: sensor.power_solar_generation
    battery_entity: sensor.solaredge_b1_dc_power
    battery_extra_entity: sensor.battery_state_of_charge
    grid_to_house_entity: sensor.power_grid_load
    grid_to_battery_entity: sensor.power_grid_battery
    generation_to_grid_entity: sensor.power_pv_grid
    generation_to_house_entity: sensor.power_pv_load
    generation_to_battery_entity: sensor.power_pv_battery
    battery_to_house_entity: sensor.power_battery_load
    generation_extra_entity: sensor.openweathermap_cloud_coverage
    appliance1_consumption_entity: sensor.shellyem_244cab4194b1_channel_2_power
  - type: custom:html-card
    card_mod:
      class: header-contained
    content: |
      <h1>isolinear grid</h1>
  - type: energy-date-selection
    card_mod:
      class: middle-contained
  - type: energy-distribution
    card_mod:
      class: middle-contained
  - type: energy-usage-graph
    card_mod:
      class: middle-contained
  - type: custom:html-card
    card_mod:
      class: footer-contained
    content: |
      &nbsp;


####################################

type: vertical-stack
cards:
  - type: vertical-stack
    cards:
      - type: vertical-stack
        cards:
          - type: custom:html-card
            card_mod:
              class: bar-right
            content: |
              <h1>energy tariff</h1>
          - type: custom:html-card
            card_mod:
              class: header-contained
            content: |
              <h1>electricity</h1>
          - type: custom:apexcharts-card
            card_mod:
              class: middle-contained
            experimental:
              color_threshold: true
            header:
              show: true
              show_states: true
              colorize_states: true
            stacked: false
            graph_span: 18h
            span:
              start: day
              offset: +6h
            now:
              show: true
              label: Now
              color: white
            yaxis:
              - min: -10
                max: 100
                decimals: 1
            series:
              - entity: >-
                  event.octopus_energy_electricity_21e5275054_2400000260098_current_day_rates
                type: column
                name: price
                color: gray
                opacity: 1
                stroke_width: 0
                unit: p/Kw
                show:
                  in_header: false
                  legend_value: false
                  header_color_threshold: true
                color_threshold:
                  - value: -100
                    color: cyan
                  - value: 0
                    color: lightgreen
                  - value: 10
                    color: darkgreen
                  - value: 20
                    color: orange
                  - value: 35
                    color: red
                data_generator: |
                  return entity.attributes.rates.map((entry) => {
                  return [new Date(entry.start), entry.value_inc_vat * 100];
                  });
          - type: custom:html-card
            card_mod:
              class: footer-contained
            content: |
              &nbsp;
  - type: custom:html-card
    card_mod:
      class: header-contained
    content: |
      <h1>rates</h1>
  - currentEntity: >-
      event.octopus_energy_electricity_21e5275054_2400000260098_current_day_rates
    pastEntity: >-
      event.octopus_energy_electricity_21e5275054_2400000260098_previous_day_rates
    futureEntity: event.octopus_energy_electricity_21e5275054_2400000260098_next_day_rates
    targetTimesEntities:
      binary_sensor.octopus_energy_target_intermittent_best_rates_total_4_hours:
        backgroundColour: green
        prefix: ðŸš™
      binary_sensor.octopus_energy_target_intermittent_best_rates_3_hours_overnight:
        backgroundColour: navy
        prefix: ðŸ 
      binary_sensor.octopus_energy_target_best_half_hour_for_pre_peak_topuo:
        backgroundColour: red
        prefix: âš¡ï¸
    type: custom:octopus-energy-rates-card
    card_mod:
      class: middle-contained
    cols: 2
    title: Octopus energy agile
    showday: true
    showpast: false
    cheapest: "Y"
    unitstr: p/kWh
    highlimit: 35
    mediumlimit: 20
    lowlimit: 10
    hour12: false
  - currentEntity: event.octopus_energy_gas_e6e03812572121_7645677109_current_day_rates
    pastEntity: event.octopus_energy_gas_e6e03812572121_7645677109_previous_day_rates
    futureEntity: event.octopus_energy_gas_e6e03812572121_7645677109_next_day_rates
    type: custom:octopus-energy-rates-card
    card_mod:
      class: middle-contained
    cols: 2
    hour12: false
    showday: true
    showpast: false
    title: Gas Tracker Rate
    combinerate: "Y"
  - type: custom:apexcharts-card
    card_mod:
      class: middle-contained
    experimental:
      color_threshold: true
    header:
      show: true
      title: Green Days Forecast
    graph_span: 7d
    span:
      start: hour
    apex_config:
      chart:
        height: 135
      stroke:
        width: 4
    series:
      - entity: sensor.octopus_energy_a_e0d4de23_greenness_forecast_current_index
        name: Forecast
        show:
          in_header: false
          legend_value: false
        color_threshold:
          - value: 0
            color: red
          - value: 40
            color: orange
          - value: 80
            color: green
        data_generator: |
          return entity.attributes.forecast.slice(0, 7).map((entry) => {
          return [new Date(entry.start), entry.greenness_score];
            });
  - type: custom:html-card
    card_mod:
      class: footer-contained
    content: |
      &nbsp;


#############################################################

type: vertical-stack
cards:
  - type: custom:html-card
    card_mod:
      class: bar-left
    content: |
      <h1>today's financials</h1>
  - type: custom:layout-card
    layout_type: custom:grid-layout
    cards:
      - type: gauge
        card_mod:
          class: middle-blank
        entity: >-
          sensor.octopus_energy_electricity_21e5275054_2400000260098_current_accumulative_cost
        segments:
          - from: -14
            to: -13.5
            color: "#04d916"
          - from: -13.5
            to: -13
            color: "#16db18"
          - from: -13
            to: -12.5
            color: "#29e11b"
          - from: -12.5
            to: -12
            color: "#3ce71d"
          - from: -12
            to: -11.5
            color: "#50ed20"
          - from: -11.5
            to: -11
            color: "#63f324"
          - from: -11
            to: -10.5
            color: "#76f927"
          - from: -10.5
            to: -10
            color: "#89ff2a"
          - from: -10
            to: -9.5
            color: "#9cff2c"
          - from: -9.5
            to: -9
            color: "#aff92f"
          - from: -9
            to: -8.5
            color: "#c3ff31"
          - from: -8.5
            to: -8
            color: "#d6ff34"
          - from: -8
            to: -7.5
            color: "#e9ff36"
          - from: -7.5
            to: -7
            color: "#fcff39"
          - from: -7
            to: -6.5
            color: "#fdff3c"
          - from: -6.5
            to: -6
            color: "#ffff3e"
          - from: -6
            to: -5.5
            color: "#fffa4d"
          - from: -5.5
            to: -5
            color: "#fff55c"
          - from: -5
            to: -4.5
            color: "#fff06b"
          - from: -4.5
            to: -4
            color: "#ffeb7a"
          - from: -4
            to: -3.5
            color: "#ffe689"
          - from: -3.5
            to: -3
            color: "#ffe198"
          - from: -3
            to: -2.5
            color: "#ffdc7b"
          - from: -2.5
            to: -2
            color: "#ffd85e"
          - from: -2
            to: -1.5
            color: "#ffd441"
          - from: -1.5
            to: -1
            color: "#ffd024"
          - from: -1
            to: -0.5
            color: "#ffcc07"
          - from: -0.5
            to: 0
            color: "#ffbf07"
          - from: 0
            to: 0.5
            color: "#ffb207"
          - from: 0.5
            to: 1
            color: "#ffa507"
          - from: 1
            to: 1.5
            color: "#ff9807"
          - from: 1.5
            to: 2
            color: "#ff8b06"
          - from: 2
            to: 2.5
            color: "#ff7e06"
          - from: 2.5
            to: 3
            color: "#ff7106"
          - from: 3
            to: 3.5
            color: "#ff6405"
          - from: 3.5
            to: 4
            color: "#ff5705"
          - from: 4
            to: 4.5
            color: "#ff4a05"
          - from: 4.5
            to: 5
            color: "#ff3d04"
          - from: 5
            to: 5.5
            color: "#ff3004"
          - from: 5.5
            to: 6
            color: "#ff2304"
          - from: 6
            to: 7.5
            color: "#ff1604"
          - from: 7.5
            to: 8
            color: "#ff0904"
          - from: 8
            to: 8.5
            color: "#ff0b0a"
          - from: 8.5
            to: 9
            color: "#ff0d10"
          - from: 9
            to: 9.5
            color: "#ff0f17"
          - from: 9.5
            to: 10
            color: "#ff0f0f"
        needle: true
        min: -14
        max: 10
        name: Import Cost
      - type: gauge
        card_mod:
          class: middle-blank
        entity: sensor.electricity_bill_today
        segments:
          - from: -14
            to: -13.5
            color: "#04d916"
          - from: -13.5
            to: -13
            color: "#16db18"
          - from: -13
            to: -12.5
            color: "#29e11b"
          - from: -12.5
            to: -12
            color: "#3ce71d"
          - from: -12
            to: -11.5
            color: "#50ed20"
          - from: -11.5
            to: -11
            color: "#63f324"
          - from: -11
            to: -10.5
            color: "#76f927"
          - from: -10.5
            to: -10
            color: "#89ff2a"
          - from: -10
            to: -9.5
            color: "#9cff2c"
          - from: -9.5
            to: -9
            color: "#aff92f"
          - from: -9
            to: -8.5
            color: "#c3ff31"
          - from: -8.5
            to: -8
            color: "#d6ff34"
          - from: -8
            to: -7.5
            color: "#e9ff36"
          - from: -7.5
            to: -7
            color: "#fcff39"
          - from: -7
            to: -6.5
            color: "#fdff3c"
          - from: -6.5
            to: -6
            color: "#ffff3e"
          - from: -6
            to: -5.5
            color: "#fffa4d"
          - from: -5.5
            to: -5
            color: "#fff55c"
          - from: -5
            to: -4.5
            color: "#fff06b"
          - from: -4.5
            to: -4
            color: "#ffeb7a"
          - from: -4
            to: -3.5
            color: "#ffe689"
          - from: -3.5
            to: -3
            color: "#ffe198"
          - from: -3
            to: -2.5
            color: "#ffdc7b"
          - from: -2.5
            to: -2
            color: "#ffd85e"
          - from: -2
            to: -1.5
            color: "#ffd441"
          - from: -1.5
            to: -1
            color: "#ffd024"
          - from: -1
            to: -0.5
            color: "#ffcc07"
          - from: -0.5
            to: 0
            color: "#ffbf07"
          - from: 0
            to: 0.5
            color: "#ffb207"
          - from: 0.5
            to: 1
            color: "#ffa507"
          - from: 1
            to: 1.5
            color: "#ff9807"
          - from: 1.5
            to: 2
            color: "#ff8b06"
          - from: 2
            to: 2.5
            color: "#ff7e06"
          - from: 2.5
            to: 3
            color: "#ff7106"
          - from: 3
            to: 3.5
            color: "#ff6405"
          - from: 3.5
            to: 4
            color: "#ff5705"
          - from: 4
            to: 4.5
            color: "#ff4a05"
          - from: 4.5
            to: 5
            color: "#ff3d04"
          - from: 5
            to: 5.5
            color: "#ff3004"
          - from: 5.5
            to: 6
            color: "#ff2304"
          - from: 6
            to: 7.5
            color: "#ff1604"
          - from: 7.5
            to: 8
            color: "#ff0904"
          - from: 8
            to: 8.5
            color: "#ff0b0a"
          - from: 8.5
            to: 9
            color: "#ff0d10"
          - from: 9
            to: 9.5
            color: "#ff0f17"
          - from: 9.5
            to: 10
            color: "#ff0f0f"
        needle: true
        min: -14
        max: 10
        name: Net Cost
      - type: gauge
        card_mod:
          class: middle-blank
        entity: sensor.solar_accounting_outgoing_fixed_compensation
        name: Export Value
        min: -14
        max: 10
        needle: true
        segments:
          - from: -14
            to: -13.5
            color: "#04d916"
          - from: -13.5
            to: -13
            color: "#16db18"
          - from: -13
            to: -12.5
            color: "#29e11b"
          - from: -12.5
            to: -12
            color: "#3ce71d"
          - from: -12
            to: -11.5
            color: "#50ed20"
          - from: -11.5
            to: -11
            color: "#63f324"
          - from: -11
            to: -10.5
            color: "#76f927"
          - from: -10.5
            to: -10
            color: "#89ff2a"
          - from: -10
            to: -9.5
            color: "#9cff2c"
          - from: -9.5
            to: -9
            color: "#aff92f"
          - from: -9
            to: -8.5
            color: "#c3ff31"
          - from: -8.5
            to: -8
            color: "#d6ff34"
          - from: -8
            to: -7.5
            color: "#e9ff36"
          - from: -7.5
            to: -7
            color: "#fcff39"
          - from: -7
            to: -6.5
            color: "#fdff3c"
          - from: -6.5
            to: -6
            color: "#ffff3e"
          - from: -6
            to: -5.5
            color: "#fffa4d"
          - from: -5.5
            to: -5
            color: "#fff55c"
          - from: -5
            to: -4.5
            color: "#fff06b"
          - from: -4.5
            to: -4
            color: "#ffeb7a"
          - from: -4
            to: -3.5
            color: "#ffe689"
          - from: -3.5
            to: -3
            color: "#ffe198"
          - from: -3
            to: -2.5
            color: "#ffdc7b"
          - from: -2.5
            to: -2
            color: "#ffd85e"
          - from: -2
            to: -1.5
            color: "#ffd441"
          - from: -1.5
            to: -1
            color: "#ffd024"
          - from: -1
            to: -0.5
            color: "#ffcc07"
          - from: -0.5
            to: 0
            color: "#ffbf07"
          - from: 0
            to: 0.5
            color: "#ffb207"
          - from: 0.5
            to: 1
            color: "#ffa507"
          - from: 1
            to: 1.5
            color: "#ff9807"
          - from: 1.5
            to: 2
            color: "#ff8b06"
          - from: 2
            to: 2.5
            color: "#ff7e06"
          - from: 2.5
            to: 3
            color: "#ff7106"
          - from: 3
            to: 3.5
            color: "#ff6405"
          - from: 3.5
            to: 4
            color: "#ff5705"
          - from: 4
            to: 4.5
            color: "#ff4a05"
          - from: 4.5
            to: 5
            color: "#ff3d04"
          - from: 5
            to: 5.5
            color: "#ff3004"
          - from: 5.5
            to: 6
            color: "#ff2304"
          - from: 6
            to: 7.5
            color: "#ff1604"
          - from: 7.5
            to: 8
            color: "#ff0904"
          - from: 8
            to: 8.5
            color: "#ff0b0a"
          - from: 8.5
            to: 9
            color: "#ff0d10"
          - from: 9
            to: 9.5
            color: "#ff0f17"
          - from: 9.5
            to: 10
            color: "#ff0f0f"
      - type: gauge
        card_mod:
          class: middle-blank
        entity: >-
          sensor.octopus_energy_gas_e6e03812572121_7645677109_current_accumulative_cost
        needle: true
        segments:
          - from: 0
            to: 0.25
            color: "#04d916"
          - from: 0.25
            to: 0.5
            color: "#16db18"
          - from: 0.5
            to: 0.75
            color: "#29e11b"
          - from: 0.75
            to: 1
            color: "#3ce71d"
          - from: 1
            to: 1.25
            color: "#50ed20"
          - from: 1.25
            to: 1.5
            color: "#63f324"
          - from: 1.5
            to: 1.75
            color: "#76f927"
          - from: 1.75
            to: 2
            color: "#89ff2a"
          - from: 2
            to: 2.25
            color: "#9cff2c"
          - from: 2.25
            to: 2.5
            color: "#aff92f"
          - from: 2.5
            to: 2.75
            color: "#c3ff31"
          - from: 2.75
            to: 3
            color: "#d6ff34"
          - from: 3
            to: 3.25
            color: "#e9ff36"
          - from: 3.25
            to: 3.5
            color: "#fcff39"
          - from: 3.5
            to: 3.75
            color: "#fdff3c"
          - from: 3.75
            to: 4
            color: "#ffff3e"
          - from: 4
            to: 4.25
            color: "#fffa4d"
          - from: 4.25
            to: 4.5
            color: "#fff55c"
          - from: 4.5
            to: 4.75
            color: "#fff06b"
          - from: 4.75
            to: 5
            color: "#ffeb7a"
          - from: 5
            to: 5.25
            color: "#ffe689"
          - from: 5.25
            to: 5.5
            color: "#ffe198"
          - from: 5.5
            to: 5.75
            color: "#ffdc7b"
          - from: 5.75
            to: 6
            color: "#ffd85e"
          - from: 6
            to: 6.25
            color: "#ffd441"
          - from: 6.25
            to: 6.5
            color: "#ffd024"
          - from: 6.5
            to: 6.75
            color: "#ffcc07"
          - from: 6.75
            to: 7
            color: "#ffbf07"
          - from: 7
            to: 7.25
            color: "#ffb207"
          - from: 7.25
            to: 7.5
            color: "#ffa507"
          - from: 7.5
            to: 7.75
            color: "#ff9807"
          - from: 7.75
            to: 8
            color: "#ff8b06"
          - from: 8
            to: 8.25
            color: "#ff7e06"
          - from: 8.25
            to: 8.5
            color: "#ff7106"
          - from: 8.5
            to: 8.75
            color: "#ff6405"
          - from: 8.75
            to: 9
            color: "#ff5705"
          - from: 9
            to: 9.25
            color: "#ff4a05"
          - from: 9.25
            to: 9.5
            color: "#ff3d04"
          - from: 9.5
            to: 9.75
            color: "#ff3004"
          - from: 9.75
            to: 10
            color: "#ff2304"
          - from: 10
            to: 10.25
            color: "#ff1604"
          - from: 10.25
            to: 10.5
            color: "#ff0904"
          - from: 10.5
            to: 10.75
            color: "#ff0b0a"
          - from: 10.75
            to: 11
            color: "#ff0d10"
          - from: 11
            to: 11.5
            color: "#ff0f17"
          - from: 11.5
            to: 12
            color: "#ff0f0f"
        name: Gas Bill
        min: 0
        max: 10
    layout:
      width: 300
      max_cols: 2
      grid-template-columns: 50% 50%
  - type: custom:html-card
    card_mod:
      class: bar-left
    content: |
      <h1>self consumption</h1>
  - type: custom:html-card
    card_mod:
      class: header-contained
    content: |
      &nbsp;
  - type: energy-grid-neutrality-gauge
    card_mod:
      class: middle-contained
  - type: energy-carbon-consumed-gauge
    card_mod:
      class: middle-contained
  - type: custom:apexcharts-card
    card_mod:
      class: middle-contained
    series:
      - entity: sensor.solar_panel_to_house_daily
        name: Direct Consumption
        color: var(--energy-solar-color)
      - entity: sensor.solar_battery_out_daily
        name: Battery Usage
        color: var(--energy-battery-out-color)
      - entity: sensor.solar_imported_power_daily
        name: Imported Power
        color: var(--energy-grid-consumption-color)
    update_interval: 1min
    chart_type: donut
    apex_config:
      plotOptions:
        pie:
          expandOnClick: false
          donut:
            size: 50%
            labels:
              show: true
              value:
                fontSize: 32px
                fontWeight: 900
              total:
                show: true
                showAlways: true
                label: Self-Consumption Rate
                formatter: |
                  EVAL:function(w) {
                    let values = w.globals.seriesTotals;
                    let total = values[0] + values[1] + values[2];
                    let self = values[0] + values[1];
                    return ((self / total) * 100).toFixed(0) + "%";
                  }
      dataLabels:
        formatter: |
          EVAL:function(value) {
            return value.toFixed(0) + "%";
          }
      chart:
        selection:
          enabled: false
      tooltip:
        enabled: false
      states:
        normal:
          filter:
            type: none
            value: 0
        hover:
          filter:
            type: none
            value: 0
        active:
          filter:
            type: none
            value: 0
      legend:
        onItemClick:
          toggleDataSeries: false
        onItemHover:
          highlightDataSeries: false
  - type: custom:apexcharts-card
    card_mod:
      class: middle-contained
    series:
      - entity: sensor.solar_panel_to_house_daily
        name: Direct Usage
        color: var(--energy-solar-color)
      - entity: sensor.solar_battery_in_daily
        name: Battery Charging
        color: var(--energy-battery-in-color)
      - entity: sensor.solar_exported_power_daily
        name: Exported Power
        color: var(--energy-grid-return-color)
    update_interval: 1min
    chart_type: donut
    apex_config:
      plotOptions:
        pie:
          expandOnClick: false
          donut:
            size: 50%
            labels:
              show: true
              value:
                fontSize: 32px
                fontWeight: 900
              total:
                show: true
                showAlways: true
                label: Self Consumption
                formatter: |
                  EVAL:function(w) {
                    let values = w.globals.seriesTotals;
                    let total = values[0] + values[1] + values[2];
                    let self = values[0] + values[1];
                    return ((self / total) * 100).toFixed(0) + "%";
                  }
      dataLabels:
        formatter: |
          EVAL:function(value) {
            return value.toFixed(0) + "%";
          }
      chart:
        selection:
          enabled: false
      tooltip:
        enabled: false
      states:
        normal:
          filter:
            type: none
            value: 0
        hover:
          filter:
            type: none
            value: 0
        active:
          filter:
            type: none
            value: 0
      legend:
        onItemClick:
          toggleDataSeries: false
        onItemHover:
          highlightDataSeries: false
  - type: custom:html-card
    card_mod:
      class: footer-contained
    content: |
      &nbsp;
  - type: custom:html-card
    card_mod:
      class: bar-left
    content: |
      <h1>financials</h1>
  - type: custom:html-card
    card_mod:
      class: header-contained
    content: |
      &nbsp;
  - type: entities
    card_mod:
      class: middle-contained
    entities:
      - entity: >-
          sensor.octopus_energy_electricity_21e5275054_2400000260098_current_rate
        name: Current Import Rate
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: 
             {% if states(config.entity)|float(0) > 0.35 %}
             red
             {% elif states(config.entity)|float(0) > 0.20 %}
             orange
             {% else %}
             green
             {% endif %};
             }
      - entity: sensor.octopus_energy_electricity_21e5275054_2400000260098_next_rate
        name: Next Import Rate
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: 
             {% if states(config.entity)|float(0) > 0.35 %}
             red
             {% elif states(config.entity)|float(0) > 0.20 %}
             orange
             {% else %}
             green
             {% endif %};
             }
      - entity: >-
          sensor.octopus_energy_electricity_21e5275054_2400001158215_export_current_rate
        name: Export Rate
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: gold;
             }
      - entity: >-
          sensor.octopus_energy_electricity_21e5275054_2400000260098_current_standing_charge
        name: Standing Charge
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: gold;
             }
      - entity: >-
          sensor.octopus_energy_electricity_21e5275054_2400000260098_current_accumulative_cost
        name: Import For Today
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: 
             {% if states(config.entity)|float(0) > 3 %}
             red
             {% elif states(config.entity)|float(0) > 2 %}
             orange
             {% else %}
             green
             {% endif %};
             }
      - entity: sensor.agile_import_cost_monthly
        name: Import This Month
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: 
             {% if states(config.entity)|float(0) > 50 %}
             red
             {% elif states(config.entity)|float(0) > 20 %}
             orange
             {% else %}
             green
             {% endif %};
             }
        icon: mdi:cash-minus
      - entity: sensor.solar_accounting_outgoing_fixed_compensation
        name: Export Compensation Today
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: 
             {% if states(config.entity)|float(0) > 3 %}
             green
             {% elif states(config.entity)|float(0) > 1 %}
             orange
             {% else %}
             red
             {% endif %};
             }
      - entity: sensor.export_compensation_outgoing_fixed_monthly
        name: Export Compensation This Month
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: 
             {% if states(config.entity)|float(0) > 30 %}
             green
             {% elif states(config.entity)|float(0) > 20 %}
             orange
             {% else %}
             green
             {% endif %};
             }
        icon: mdi:cash-plus
      - entity: sensor.electricity_bill_today
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: 
             {% if states(config.entity)|float(0) > 3 %}
             red
             {% elif states(config.entity)|float(0) > 2 %}
             orange
             {% else %}
             green
             {% endif %};
             }
        icon: mdi:equal
      - entity: sensor.electricity_bill_this_month
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: 
             {% if states(config.entity)|float(0) > 50 %}
             red
             {% elif states(config.entity)|float(0) > 30 %}
             orange
             {% else %}
             green
             {% endif %};
             }
        icon: mdi:equal
  - type: custom:html-card
    card_mod:
      class: footer-contained
    content: |
      &nbsp;
  - type: custom:html-card
    card_mod:
      class: bar-left
    content: |
      <h1>long term financials</h1>
  - type: custom:html-card
    card_mod:
      class: header-contained
    content: |
      &nbsp;
  - type: entities
    card_mod:
      class: middle-contained
    entities:
      - entity: sensor.total_energy_cost_daily_2
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #f08080;
             }
        name: Energy Bill
        icon: mdi:equal
      - entity: sensor.total_energy_cost_weekly
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #cd5c5c;
             }
        name: Total Energy Bill Weekly
        icon: mdi:equal
      - entity: sensor.total_energy_cost_monthly
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #8b0000;
             }
        name: Total Energy Bill Monthly
        icon: mdi:equal
      - entity: sensor.total_energy_cost_yearly
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #ff0000;
             }
        name: Total Energy Bill Yearly
        icon: mdi:equal
      - type: custom:template-entity-row
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #adff2f;
             }
        icon: mdi:piggy-bank
        name: Today's Saving
        state: |-
          - Â£{{ ((states('sensor.solar_panel_to_house_daily') | float(0)) + 
           (states('sensor.solar_battery_out_daily') | float(0)) * 0.18) | round(2)}}
      - type: custom:template-entity-row
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #7fff00;
             }
        icon: mdi:piggy-bank
        name: This Week's Saving
        state: >-
          - Â£{{ ((states('sensor.solar_panel_to_house_weekly') | float(0)) +
          (states('sensor.solar_battery_out_weekly') | float(0)) * 0.18) | 
          round(2)}} 
      - type: custom:template-entity-row
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #32cd32;
             }
        icon: mdi:piggy-bank
        name: This Month's Saving
        state: >-
          - Â£{{ ((states('sensor.solar_panel_to_house_monthly') | float(0)) +
          (states('sensor.solar_battery_out_monthly') | float(0)) * 0.18) |
          round(2)}}
      - type: custom:template-entity-row
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #008000;
             }
        icon: mdi:piggy-bank
        name: This Year's Saving
        state: >-
          - Â£{{ ((states('sensor.solar_panel_to_house_yearly') | float(0)) +
          (states('sensor.solar_battery_out_yearly') | float(0)) * 0.18) |
          round(2)}}
  - type: custom:html-card
    card_mod:
      class: footer-contained
    content: |
      &nbsp;
  - type: custom:html-card
    card_mod:
      class: bar-left
    content: |
      <h1>long term statistics</h1>
  - type: custom:html-card
    card_mod:
      class: header-contained
    content: |
      &nbsp;
  - type: custom:html-card
    card_mod:
      class: bar-left
    content: |
      <h1>week</h1>
  - type: entities
    card_mod:
      class: middle-contained
    entities:
      - entity: sensor.solar_panel_production_weekly
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #7fff00;
             }
        name: Solar Production This Week
        icon: mdi:solar-power-variant
      - entity: sensor.solar_battery_in_weekly
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #7fff00;
             }
        name: Solar Battery In This Week
        icon: mdi:battery-plus
      - entity: sensor.solar_battery_out_weekly
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #cd5c5c;
             }
        name: Solar Battery Out This Week
        icon: mdi:battery-minus
  - type: custom:html-card
    card_mod:
      class: bar-left
    content: |
      <h1>month</h1>
  - type: entities
    card_mod:
      class: middle-contained
    entities:
      - entity: sensor.solar_panel_production_monthly
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #32cd32;
             }
        name: Solar Production This Month
        icon: mdi:solar-power-variant
      - entity: sensor.solar_battery_in_monthly
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #32cd32;
             }
        name: Solar Battery In This Month
        icon: mdi:battery-plus
      - entity: sensor.solar_battery_out_monthly
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #8b0000;
             }
        name: Solar Battery Out This Month
        icon: mdi:battery-minus
  - type: custom:html-card
    card_mod:
      class: bar-left
    content: |
      <h1>year</h1>
  - type: entities
    card_mod:
      class: middle-contained
    entities:
      - entity: sensor.solar_panel_production_yearly
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #008000;
             }
        name: Solar Production This Year
        icon: mdi:solar-power-variant
      - entity: sensor.solar_battery_in_yearly
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #008000;
             }
        name: Solar Battery In This Year
        icon: mdi:battery-plus
      - entity: sensor.solar_battery_out_yearly
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #ff0000;
             }
        name: Solar Battery Out This Year
        icon: mdi:battery-plus
  - type: custom:html-card
    card_mod:
      class: bar-right
    content: |
      <h1>records</h1>
  - type: entities
    entities:
      - entity: sensor.ath_power_import
        icon: mdi:transmission-tower-import
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #ff0000;
             }
      - entity: sensor.ath_solar_generated
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #7fff00;
             }
        icon: mdi:solar-panel-large
      - entity: sensor.atl_solar_generated
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #cd5c5c;
             }
        icon: mdi:solar-panel
    card_mod:
      class: middle-contained
  - type: custom:html-card
    card_mod:
      class: footer-contained
    content: |
      &nbsp;

###### Mobile Phone Operations ################

type: vertical-stack
cards:
  - type: custom:mushroom-template-card
    primary: operations
    secondary: stardate {{states('sensor.stardate')}}
    icon: mdi:controller
  - type: custom:mushroom-template-card
    primary: |
      Captains Log: Stardate {{states('sensor.stardate')}} 
    secondary: >
      {% set time = now().hour %} {% if (time >= 18) %} Good Evening {{ user
      }}.  {% elif (time >=12) %} Good Afternoon {{ user }}.  {% elif (time >=
      5) %} Good Morning {{ user }}.  {% else %} Hello {{ user }}.  {% endif %} 

      central control selected.

      Terrestrial date is {{ states('sensor.day_of_week')}} {{
      as_timestamp(now()) | timestamp_custom ('%-d %B %Y' )}}. 

      view and set ships controls here
    multiline_secondary: true
    fill_container: true
    icon: ""
    card_mod:
      class: middle-contained
      style: |
        ha-card {
          --card-primary-font-size: 17px !important;
          --card-secondary-line-height: 23px !important;
        }
  - type: custom:html-card
    card_mod:
      class: footer-contained
    content: |
      &nbsp;
  - type: custom:html-card
    card_mod:
      class: bar-right
    content: |
      <h1>aux power settings 1</h1>
    alignment: center
  - type: custom:html-card
    card_mod:
      class: header-contained
    content: |
      &nbsp;
  - type: custom:timer-bar-card
    card_mod:
      class: middle-contained
    bar_direction: ltr
    bar_radius: 4px
    sync_issues: ignore
    entities:
      - timer.home_battery_3_hour_charge_period
    translations:
      idle: Not Running
    modifications:
      - elapsed: 0%
        bar_foreground: green
        active_icon: mdi:timer-check
        state_color: true
        bar_height: 12px
      - elapsed: 85%
        bar_foreground: orange
        active_icon: mdi:timer-check-outline
        state_color: true
        bar_height: 12px
      - elapsed: 95%
        bar_foreground: red
        active_icon: mdi:timer-alert
        state_color: true
  - type: entities
    card_mod:
      class: middle-contained
    state_color: true
    entities:
      - entity: input_number.home_battery_charge_length
        card_mod:
          style:
            hui-generic-entity-row $: |
              .info {
                text-overflow: unset !important;
                white-space: unset !important;
              }
              :host {
                --ha-textfield-input-width: 20px;
              }
              state-badge {
                color: #00ff00;
              }  
            ha-textfield $: |
              label {
                padding-right: 10px !important;
                padding-left: 20px !important;
              }
              .mdc-text-field {
                height: 20px !important;
                }
              .mdc-line-ripple::after,
              .mdc-line-ripple::before {
               border-bottom-style: none !important;
                 }
      - entity: sensor.solar_battery_time_to_charge_grid
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: red
             }
        name: Length of time to grid charge
        icon: mdi:clock
      - entity: input_number.solar_production_threshold_for_grid_charging_battery
        card_mod:
          style:
            hui-generic-entity-row $: |
              .info {
                text-overflow: unset !important;
                white-space: unset !important;
              }
              :host {
                --ha-textfield-input-width: 20px;
              }
              state-badge {
                color: gold;
              }  
            ha-textfield $: |
              label {
                padding-right: 10px !important;
                padding-left: 20px !important;
              }
              .mdc-text-field {
                height: 20px !important;
                }
              .mdc-line-ripple::after,
              .mdc-line-ripple::before {
               border-bottom-style: none !important;
                 }
      - type: custom:template-entity-row
        name: Start Best Half Hour Slots over 3 Hour Period 10pm to 8am
        icon: mdi:camera-timer
        card_mod:
          style:
            div#wrapper: |
              state-badge {
                {% if is_state('binary_sensor.octopus_energy_target_intermittent_best_rates_3_hours_overnight','on') %}
                color: gold;
                {% else %}
                color: blue;
                {% endif %}
              }
            hui-generic-entity-row:
              $: |
                .info {
                  text-overflow: unset !important;
                  white-space: unset !important;
                }
        tap_action:
          action: more-info
        active: >-
          {{
          is_state('binary_sensor.octopus_energy_target_intermittent_best_rates_3_hours_overnight',
          'on')}}
        entity: >-
          binary_sensor.octopus_energy_target_intermittent_best_rates_3_hours_overnight
        state: >-
          {% if
          is_state('binary_sensor.octopus_energy_target_intermittent_best_rates_3_hours_overnight',
          'on') %}
            Active
          {% else %}
            Waiting
          {% endif %}
        secondary: >-
          Starts at {% set time_start =
          state_attr('binary_sensor.octopus_energy_target_intermittent_best_rates_total_3_hours','next_time')%}
            {{ as_timestamp(time_start) | timestamp_custom ('%H:%M')}}
      - entity: input_number.pre_peak_topup_length
        card_mod:
          style:
            hui-generic-entity-row $: |
              .info {
                text-overflow: unset !important;
                white-space: unset !important;
              }
              :host {
                --ha-textfield-input-width: 20px;
              }
              state-badge {
                color: #00ff00;
              }  
            ha-textfield $: |
              label {
                padding-right: 10px !important;
                padding-left: 20px !important;
              }
              .mdc-text-field {
                height: 20px !important;
                }
              .mdc-line-ripple::after,
              .mdc-line-ripple::before {
               border-bottom-style: none !important;
                 }
      - type: custom:template-entity-row
        name: Best Half Hour Pre-Peak Slot
        icon: mdi:camera-timer
        card_mod:
          style:
            div#wrapper: |
              state-badge {
                {% if is_state('binary_sensor.octopus_energy_target_best_half_hour_for_pre_peak_topuo','on') %}
                color: gold;
                {% else %}
                color: blue;
                {% endif %}
              }
        tap_action:
          action: more-info
        active: >-
          {{
          is_state('binary_sensor.octopus_energy_target_best_half_hour_for_pre_peak_topuo',
          'on')}}
        entity: binary_sensor.octopus_energy_target_best_half_hour_for_pre_peak_topuo
        state: >-
          {% if
          is_state('binary_sensor.octopus_energy_target_best_half_hour_for_pre_peak_topuo',
          'on') %}
            Active
          {% else %}
            Waiting
          {% endif %}
        secondary: >-
          Starts at {% set time_start =
          state_attr('binary_sensor.octopus_energy_target_best_half_hour_for_pre_peak_topuo','next_time')%}
            {{ as_timestamp(time_start) | timestamp_custom ('%H:%M')}}
      - entity: input_boolean.grid_charge_home_battery
        card_mod:
          style:
            hui-generic-entity-row:
              ha-entity-toggle:
                $: |
                  ha-switch {
                  --switch-unchecked-button-color: #ec7063;
                  --switch-unchecked-track-color: #ec7063;
                  --switch-checked-button-color: #58d68d;
                  --switch-checked-track-color: #58d68d;
                  }
        name: Grid Charge Battery Master
      - entity: input_boolean.charge_rate_limited
        card_mod:
          style:
            hui-generic-entity-row:
              ha-entity-toggle:
                $: |
                  ha-switch {
                  --switch-unchecked-button-color: #ec7063;
                  --switch-unchecked-track-color: #ec7063;
                  --switch-checked-button-color: #58d68d;
                  --switch-checked-track-color: #58d68d;
                  }
        name: Charge Rate Limited
      - entity: number.solaredge_i1_storage_charge_limit
        card_mod:
          style:
            hui-generic-entity-row $: |
              .info {
                text-overflow: unset !important;
                white-space: unset !important;
              }
              :host {
                --ha-textfield-input-width: 40px;
              }
              state-badge {
              color: #58d68d;
              }
            ha-textfield $: |
              label {
                padding-right: 10px !important;
                padding-left: 20px !important;
              }
              .mdc-text-field {
                height: 20px !important;
                }
              .mdc-line-ripple::after,
              .mdc-line-ripple::before {
               border-bottom-style: none !important;
                 }
        name: Actual Charge Limit
        icon: mdi:battery-check
      - entity: input_boolean.allow_battery_grid_discharge
        card_mod:
          style:
            hui-generic-entity-row:
              ha-entity-toggle:
                $: |
                  ha-switch {
                  --switch-unchecked-button-color: #ec7063;
                  --switch-unchecked-track-color: #ec7063;
                  --switch-checked-button-color: #58d68d;
                  --switch-checked-track-color: #58d68d;
                  }
      - entity: input_datetime.start_battery_discharge
        card_mod:
          style:
            ha-time-input $ ha-base-time-input $:
              ha-textfield:
                $: |
                  .mdc-text-field {
                  height: 20px !important;
                  }
                  .mdc-line-ripple::after,
                  .mdc-line-ripple::before {
                   border-bottom-style: none !important;
                   }
            hui-generic-entity-row $: |
              state-badge {
              color: green;
              }  
      - entity: input_datetime.end_battery_discharge
        card_mod:
          style:
            ha-time-input $ ha-base-time-input $:
              ha-textfield:
                $: |
                  .mdc-text-field {
                  height: 20px !important;
                  }
                  .mdc-line-ripple::after,
                  .mdc-line-ripple::before {
                   border-bottom-style: none !important;
                   }
            hui-generic-entity-row $: |
              state-badge {
              color: red;
              }
      - entity: input_number.storage_command_timeout_period_for_clipped_solar
        card_mod:
          style:
            hui-generic-entity-row $: |
              .info {
                text-overflow: unset !important;
                white-space: unset !important;
              }
              :host {
                --ha-textfield-input-width: 40px;
              }
              state-badge {
              color: green;
              }
            ha-textfield $: |
              label {
                padding-right: 10px !important;
                padding-left: 20px !important;
              }
              .mdc-text-field {
                height: 20px !important;
                }
              .mdc-line-ripple::after,
              .mdc-line-ripple::before {
               border-bottom-style: none !important;
                 }
      - entity: input_number.storage_command_timeout_for_discharge_to_grid
        card_mod:
          style:
            hui-generic-entity-row $: |
              .info {
                text-overflow: unset !important;
                white-space: unset !important;
              }
              :host {
                --ha-textfield-input-width: 40px;
              }
              state-badge {
              color: green;
              }
            ha-textfield $: |
              label {
                padding-right: 10px !important;
                padding-left: 20px !important;
              }
              .mdc-text-field {
                height: 20px !important;
                }
              .mdc-line-ripple::after,
              .mdc-line-ripple::before {
               border-bottom-style: none !important;
                 }
      - entity: input_number.storage_command_timeout_default_period
        card_mod:
          style:
            hui-generic-entity-row $: |
              .info {
                text-overflow: unset !important;
                white-space: unset !important;
              }
              :host {
                --ha-textfield-input-width: 40px;
              }
              state-badge {
              color: green;
              }
            ha-textfield $: |
              label {
                padding-right: 10px !important;
                padding-left: 20px !important;
              }
              .mdc-text-field {
                height: 20px !important;
                }
              .mdc-line-ripple::after,
              .mdc-line-ripple::before {
               border-bottom-style: none !important;
                 }
  - type: custom:html-card
    card_mod:
      class: bar-right
    content: |
      <h1>limit storage output</h1>
  - type: entities
    state_color: true
    entities:
      - entity: input_boolean.allow_battery_output_limit
        card_mod:
          style:
            hui-generic-entity-row:
              ha-entity-toggle:
                $: |
                  ha-switch {
                  --switch-unchecked-button-color: #ec7063;
                  --switch-unchecked-track-color: #ec7063;
                  --switch-checked-button-color: #58d68d;
                  --switch-checked-track-color: #58d68d;
                  }
      - entity: input_boolean.battery_output_limit_slot_1
        card_mod:
          style:
            hui-generic-entity-row:
              ha-entity-toggle:
                $: |
                  ha-switch {
                  --switch-unchecked-button-color: #ec7063;
                  --switch-unchecked-track-color: #ec7063;
                  --switch-checked-button-color: #58d68d;
                  --switch-checked-track-color: #58d68d;
                  }
      - entity: input_datetime.start_battery_output_limit
        card_mod:
          style:
            ha-time-input $ ha-base-time-input $:
              ha-textfield:
                $: |
                  .mdc-text-field {
                  height: 20px !important;
                  }
                  .mdc-line-ripple::after,
                  .mdc-line-ripple::before {
                   border-bottom-style: none !important;
                   }
            hui-generic-entity-row $: |
              state-badge {
              color: green;
              }  
      - entity: input_datetime.end_battery_output_limit
        card_mod:
          style:
            ha-time-input $ ha-base-time-input $:
              ha-textfield:
                $: |
                  .mdc-text-field {
                  height: 20px !important;
                  }
                  .mdc-line-ripple::after,
                  .mdc-line-ripple::before {
                   border-bottom-style: none !important;
                   }
            hui-generic-entity-row $: |
              state-badge {
              color: red;
              }
      - entity: input_boolean.battery_output_limit_slot_2
        card_mod:
          style:
            hui-generic-entity-row:
              ha-entity-toggle:
                $: |
                  ha-switch {
                  --switch-unchecked-button-color: #ec7063;
                  --switch-unchecked-track-color: #ec7063;
                  --switch-checked-button-color: #58d68d;
                  --switch-checked-track-color: #58d68d;
                  }
      - entity: input_datetime.start_battery_output_limit_slot_2
        card_mod:
          style:
            ha-time-input $ ha-base-time-input $:
              ha-textfield:
                $: |
                  .mdc-text-field {
                  height: 20px !important;
                  }
                  .mdc-line-ripple::after,
                  .mdc-line-ripple::before {
                   border-bottom-style: none !important;
                   }
            hui-generic-entity-row $: |
              state-badge {
              color: green;
              }  
      - entity: input_datetime.end_battery_output_limit_slot_2
        card_mod:
          style:
            ha-time-input $ ha-base-time-input $:
              ha-textfield:
                $: |
                  .mdc-text-field {
                  height: 20px !important;
                  }
                  .mdc-line-ripple::after,
                  .mdc-line-ripple::before {
                   border-bottom-style: none !important;
                   }
            hui-generic-entity-row $: |
              state-badge {
              color: red;
              }
      - entity: input_boolean.battery_output_limit_slot_3
        card_mod:
          style:
            hui-generic-entity-row:
              ha-entity-toggle:
                $: |
                  ha-switch {
                  --switch-unchecked-button-color: #ec7063;
                  --switch-unchecked-track-color: #ec7063;
                  --switch-checked-button-color: #58d68d;
                  --switch-checked-track-color: #58d68d;
                  }
      - entity: input_datetime.start_battery_output_limit_slot_3
        card_mod:
          style:
            ha-time-input $ ha-base-time-input $:
              ha-textfield:
                $: |
                  .mdc-text-field {
                  height: 20px !important;
                  }
                  .mdc-line-ripple::after,
                  .mdc-line-ripple::before {
                   border-bottom-style: none !important;
                   }
            hui-generic-entity-row $: |
              state-badge {
              color: green;
              }  
      - entity: input_datetime.end_battery_output_limit_slot_3
        card_mod:
          style:
            ha-time-input $ ha-base-time-input $:
              ha-textfield:
                $: |
                  .mdc-text-field {
                  height: 20px !important;
                  }
                  .mdc-line-ripple::after,
                  .mdc-line-ripple::before {
                   border-bottom-style: none !important;
                   }
            hui-generic-entity-row $: |
              state-badge {
              color: red;
              }
      - entity: input_boolean.battery_output_limit_slot_4
        card_mod:
          style:
            hui-generic-entity-row:
              ha-entity-toggle:
                $: |
                  ha-switch {
                  --switch-unchecked-button-color: #ec7063;
                  --switch-unchecked-track-color: #ec7063;
                  --switch-checked-button-color: #58d68d;
                  --switch-checked-track-color: #58d68d;
                  }
      - entity: input_datetime.start_battery_output_limit_slot_4
        card_mod:
          style:
            ha-time-input $ ha-base-time-input $:
              ha-textfield:
                $: |
                  .mdc-text-field {
                  height: 20px !important;
                  }
                  .mdc-line-ripple::after,
                  .mdc-line-ripple::before {
                   border-bottom-style: none !important;
                   }
            hui-generic-entity-row $: |
              state-badge {
              color: green;
              }  
      - entity: input_datetime.end_battery_output_limit_slot_4
        card_mod:
          style:
            ha-time-input $ ha-base-time-input $:
              ha-textfield:
                $: |
                  .mdc-text-field {
                  height: 20px !important;
                  }
                  .mdc-line-ripple::after,
                  .mdc-line-ripple::before {
                   border-bottom-style: none !important;
                   }
            hui-generic-entity-row $: |
              state-badge {
              color: red;
              }
    card_mod:
      class: middle-contained
  - type: custom:html-card
    card_mod:
      class: footer-contained
    content: |
      &nbsp;

################################

type: vertical-stack
cards:
  - type: custom:html-card
    card_mod:
      class: bar-right
    content: |
      <h1>shuttlecraft settings</h1>
  - type: custom:html-card
    card_mod:
      class: header-contained
    content: |
      &nbsp;
  - type: custom:timer-bar-card
    card_mod:
      class: middle-contained
    bar_direction: ltr
    bar_radius: 4px
    entities:
      - timer.rolec_4_hour_charge_period
    translations:
      idle: Not Running
    modifications:
      - elapsed: 0%
        bar_foreground: green
        active_icon: mdi:timer-check
        state_color: true
        bar_height: 12px
      - elapsed: 85%
        bar_foreground: orange
        active_icon: mdi:timer-check-outline
        state_color: true
        bar_height: 12px
      - elapsed: 95%
        bar_foreground: red
        active_icon: mdi:timer-alert
        state_color: true
  - type: entities
    card_mod:
      class: middle-contained
    state_color: true
    entities:
      - entity: input_boolean.car_plugged_in
        card_mod:
          style:
            hui-generic-entity-row:
              ha-entity-toggle:
                $: |
                  ha-switch {
                  --switch-unchecked-button-color: #ec7063;
                  --switch-unchecked-track-color: #ec7063;
                  --switch-checked-button-color: #58d68d;
                  --switch-checked-track-color: #58d68d;
                  }
      - entity: input_boolean.rolec_battery_master
        card_mod:
          style:
            hui-generic-entity-row:
              ha-entity-toggle:
                $: |
                  ha-switch {
                  --switch-unchecked-button-color: #ec7063;
                  --switch-unchecked-track-color: #ec7063;
                  --switch-checked-button-color: #58d68d;
                  --switch-checked-track-color: #58d68d;
                  }
      - entity: input_number.car_battery_charge_level
        card_mod:
          style:
            hui-generic-entity-row $: |
              .info {
                text-overflow: unset !important;
                white-space: unset !important;
              }
              :host {
                --ha-textfield-input-width: 20px;
              }
              state-badge {
                color: green;
              }  
            ha-textfield $: |
              label {
                padding-right: 10px !important;
                padding-left: 20px !important;
              }
              .mdc-text-field {
                height: 20px !important;
                }
              .mdc-line-ripple::after,
              .mdc-line-ripple::before {
               border-bottom-style: none !important;
                 }
      - type: custom:multiple-entity-row
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #008000;
             }
        entity: sensor.battery_level_end_session
        entities:
          - entity: sensor.battery_level_start_session
            name: start
            unit: "%"
          - entity: sensor.battery_level_end_session
            name: end
            unit: "%"
          - entity: sensor.car_battery_added
            name: added
            unit: "%"
        name: Charge Session Battery
        unit: ""
        icon: mdi:battery
        toggle: false
        show_state: false
        state_header: ""
        secondary_info: null
      - type: custom:multiple-entity-row
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #008000;
             }
        entity: sensor.battery_level_end_session
        entities:
          - entity: sensor.rolec_energy_start_session
            name: start
            unit: kWh
          - entity: sensor.rolec_energy_end_session
            name: end
            unit: kWh
          - entity: sensor.rolec_energy_used
            name: added
            unit: kWh
        name: Charge Session Energy
        unit: ""
        icon: mdi:battery
        toggle: false
        show_state: false
        state_header: ""
        secondary_info: null
      - entity: sensor.car_battery_hours_to_full
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #008000;
             }
      - type: custom:multiple-entity-row
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #008000;
             }
        entity: sensor.car_battery_hours_to_full
        entities:
          - entity: sensor.cost_to_charge_to_full_20p
            name: 20p/kWh
            unit: Â£
          - entity: sensor.cost_to_charge_to_full_15p
            name: 15p/kWh
            unit: Â£
          - entity: sensor.cost_to_charge_to_full_10p
            name: 10p/kWh
            unit: Â£
          - entity: sensor.cost_to_charge_to_full_5p
            name: 5p/kWh
            unit: Â£
        name: Cost
        unit: ""
        icon: mdi:currency-gbp
        toggle: false
        show_state: false
        state_header: ""
        secondary_info: null
      - entity: input_number.ev_charge_length_hrs
        card_mod:
          style:
            hui-generic-entity-row $: |
              .info {
                text-overflow: unset !important;
                white-space: unset !important;
              }
              :host {
                --ha-textfield-input-width: 20px;
              }
              state-badge {
                color: green;
              }  
            ha-textfield $: |
              label {
                padding-right: 10px !important;
                padding-left: 20px !important;
              }
              .mdc-text-field {
                height: 20px !important;
                }
              .mdc-line-ripple::after,
              .mdc-line-ripple::before {
               border-bottom-style: none !important;
                 }
      - type: custom:template-entity-row
        name: Start Best Half Hour Slots over 5 Hour Period
        icon: mdi:camera-timer
        card_mod:
          style:
            div#wrapper: |
              state-badge {
                {% if is_state('binary_sensor.octopus_energy_target_intermittent_best_rates_total_4_hours','on') %}
                color: gold;
                {% else %}
                color: blue;
                {% endif %}
              }
        tap_action:
          action: more-info
        active: >-
          {{
          is_state('binary_sensor.octopus_energy_target_intermittent_best_rates_total_4_hours',
          'on')}}
        entity: >-
          binary_sensor.octopus_energy_target_intermittent_best_rates_total_4_hours
        state: >-
          {% if
          is_state('binary_sensor.octopus_energy_target_intermittent_best_rates_total_4_hours',
          'on') %}
            Active
          {% else %}
            Waiting
          {% endif %}
        secondary: >-
          Starts at {% set time_start =
          state_attr('binary_sensor.octopus_energy_target_intermittent_best_rates_total_4_hours','next_time')%}
            {{ as_timestamp(time_start) | timestamp_custom ('%H:%M')}}
  - type: custom:html-card
    card_mod:
      class: footer-contained
    content: |
      &nbsp;

#############################


  - type: custom:html-card
    card_mod:
      class: bar-left
    content: |
      <h1>octoplus</h1>
  - type: entities
    state_color: true
    entities:
      - entity: sensor.octopus_energy_a_e0d4de23_octoplus_points
        name: Octoplus Points Total
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #008000;
             }
      - type: custom:template-entity-row
        state: >
          {{
          state_attr('event.octopus_energy_a_e0d4de23_octoplus_saving_session_events','rewarded_octopoints')
          }}
        name: Points Awarded Last Session
        icon: mdi:currency-gbp
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #008000;
             }
      - entity: automation.octoplus_join_saving_session
        name: Join Saving Session Automagically
        card_mod:
          style:
            hui-generic-entity-row:
              ha-entity-toggle:
                $: |
                  ha-switch {
                  --switch-unchecked-button-color: #ec7063;
                  --switch-unchecked-track-color: #ec7063;
                  --switch-checked-button-color: #58d68d;
                  --switch-checked-track-color: #58d68d;
                  }
      - entity: input_boolean.saving_session_enrolled
        name: Saving Session Joined
        card_mod:
          style:
            hui-generic-entity-row:
              ha-entity-toggle:
                $: |
                  ha-switch {
                  --switch-unchecked-button-color: #ec7063;
                  --switch-unchecked-track-color: #ec7063;
                  --switch-checked-button-color: #58d68d;
                  --switch-checked-track-color: #58d68d;
                  }
      - entity: binary_sensor.octopus_energy_a_e0d4de23_octoplus_saving_sessions
        name: Saving Session
      - type: custom:template-entity-row
        state: >
          {{
          as_timestamp(state_attr('binary_sensor.octopus_energy_a_e0d4de23_octoplus_saving_sessions','next_joined_event_start'))|timestamp_custom
          ('%d/%m/%y')}}
        name: Next Saving Session on
        icon: mdi:update
        card_mod:
          style: |
            :host {
             --paper-item-icon-color: #008000;
             }
      - entity: input_datetime.two_before_start_of_saving_session
        card_mod:
          style:
            ha-time-input $ ha-base-time-input $:
              ha-textfield:
                $: |
                  .mdc-text-field {
                  height: 26px !important;
                  }
                  .mdc-line-ripple::after,
                  .mdc-line-ripple::before {
                   border-bottom-style: none !important;
                   }
            hui-generic-entity-row $: |
              state-badge {
                color: #adff2f;
              }  
      - entity: input_datetime.saving_session_start
        name: Saving Session Start
        card_mod:
          style:
            ha-time-input $ ha-base-time-input $:
              ha-textfield:
                $: |
                  .mdc-text-field {
                  height: 26px !important;
                  }
                  .mdc-line-ripple::after,
                  .mdc-line-ripple::before {
                   border-bottom-style: none !important;
                   }
            hui-generic-entity-row $: |
              state-badge {
                color: #008000;
              }  
      - entity: input_datetime.saving_session_end
        name: Saving Session End
        card_mod:
          style:
            ha-time-input $ ha-base-time-input $:
              ha-textfield:
                $: |
                  .mdc-text-field {
                  height: 26px !important;
                  }
                  .mdc-line-ripple::after,
                  .mdc-line-ripple::before {
                   border-bottom-style: none !important;
                   }
            hui-generic-entity-row $: |
              state-badge {
                color: #ff0000;
              }  
    card_mod:
      class: middle-left


